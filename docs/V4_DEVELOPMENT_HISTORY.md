# BucketsVision V4 모델 개발 히스토리

**작성일:** 2025-11-29
**최종 버전:** V4.2
**최종 정확도:** 74.32% (Brier: 0.1949, AUC-ROC: 0.7790)

---

## 1. 개발 배경

### 1.1 기존 모델 현황

| 모델 | 피처 수 | 정확도 | 특징 |
|------|--------|--------|------|
| V1 (Ridge) | 16 | 70.11% | EPM 기반 선형 회귀 |
| V2 (XGBoost) | 15 | 70.85% | 트리 기반 분류 |
| V3 (Stacking) | 26 | 72.69% | 앙상블 (RF + XGB + LR) |

### 1.2 V3 분석 결과

- **McNemar Test:** V1, V2, V3 간 차이가 통계적으로 유의하지 않음 (p > 0.05)
- **핵심 발견:** V3의 72.69% 성능은 스태킹 앙상블이 아닌 **추가 피처**에서 비롯
- **결론:** V1 기반 + V3 추가 피처 조합으로 새 모델 개발 필요

---

## 2. V4 개발 과정

### 2.1 Phase 1: 피처 분석 및 선별

**V1 피처 분석 (16개):**
- 47쌍의 높은 상관관계 (|r| > 0.8) 발견
- 다중공선성 문제로 피처 축소 필요

**V3 추가 피처 (10개):**
- Four Factors: efg_pct, tov_pct, orb_pct, ft_rate
- 모멘텀: margin_ewma, last5_win_pct, streak, pts_trend
- 컨디션: rest, b2b
- 컨텍스트: home_court_strength, away_road_strength, season_progress

### 2.2 Phase 2: Greedy Forward Selection

**방법:** 빈 피처셋에서 시작하여 정확도를 가장 높이는 피처를 순차 추가

**결과 (V4 최적 10개 피처):**
```
1. team_epm_diff      (EPM)
2. team_oepm_diff     (EPM)
3. team_depm_diff     (EPM)
4. sos_diff           (EPM)
5. last5_win_pct_diff (모멘텀)
6. efg_pct_diff       (Four Factors)
7. streak_diff        (모멘텀)
8. margin_ewma_diff   (모멘텀)
9. ft_rate_diff       (Four Factors)
10. away_road_strength (컨텍스트)
```

**V4 성능:** 74.32% (V3 대비 +1.63%p)

---

## 3. V4.1 업데이트: ORB 피처 추가

### 3.1 리바운드 피처 실험

| 피처 | V4 대비 효과 |
|------|-------------|
| **ORB (공격 리바운드)** | **+0.78%p** ★ |
| DRB (수비 리바운드) | -2.33%p |
| TRB (총 리바운드) | -1.56%p |

### 3.2 V4.1 결과

- **피처:** 11개 (V4 + orb_diff)
- **정확도:** 75.10%
- **개선:** +0.78%p

---

## 4. V4.2 업데이트: 정규화 최적화

### 4.1 정규화 강도(C) 최적화

| C 값 | 정확도 (캘리브레이션 전) |
|------|------------------------|
| 0.001 | 73.15% |
| **0.01** | **74.71%** ★ |
| 0.1~100 | 74.32% |

### 4.2 정규화 방식 비교

| 방식 | 정확도 | 비고 |
|------|--------|------|
| **L2 (Ridge)** | **74.71%** | 채택 |
| L1 (Lasso) | 71.60% | 10/11 피처 제거 |
| Elastic Net | 71~73% | L1 효과로 저하 |

### 4.3 피처 민감도 분석

```
제거 시 정확도 하락 (중요 피처):
  team_oepm_diff   -2.33%p  ★ 가장 중요
  team_depm_diff   -1.95%p
  ft_rate_diff     -1.95%p
  efg_pct_diff     -1.17%p
  orb_diff         -0.39%p
```

### 4.4 V4.2 최종 결과

| 지표 | V4.1 | V4.2 | 비고 |
|------|------|------|------|
| Accuracy | 75.10% | 74.32% | - |
| **Brier Score** | 0.1954 | **0.1949** | 확률 품질 개선 |
| **AUC-ROC** | 0.7769 | **0.7790** | 순위 변별력 개선 |
| **70%+ Accuracy** | 82.98% | **83.51%** | 고신뢰 예측 개선 |

**V4.2 채택 이유:** 확률 기반 의사결정에 더 적합

---

## 5. 최종 모델 사양

### 5.1 V4.2 피처 (11개)

| # | 피처명 | 카테고리 | 설명 |
|---|--------|----------|------|
| 1 | team_epm_diff | EPM | 종합 EPM 차이 |
| 2 | team_oepm_diff | EPM | 공격 EPM 차이 |
| 3 | team_depm_diff | EPM | 수비 EPM 차이 |
| 4 | sos_diff | EPM | 상대 강도 차이 |
| 5 | last5_win_pct_diff | 모멘텀 | 최근 5경기 승률 차이 |
| 6 | efg_pct_diff | Four Factors | eFG% 차이 |
| 7 | streak_diff | 모멘텀 | 연승/연패 차이 |
| 8 | margin_ewma_diff | 모멘텀 | EWMA 점수차 차이 |
| 9 | ft_rate_diff | Four Factors | 자유투 비율 차이 |
| 10 | away_road_strength | 컨텍스트 | 원정팀 원정 강도 |
| 11 | orb_diff | 리바운드 | 공격 리바운드 차이 |

### 5.2 모델 구성

```
StandardScaler → LogisticRegression(C=0.01, L2) → IsotonicCalibration
```

### 5.3 저장 파일

```
bucketsvision_v4/models/
├── v4_model.pkl          # CalibratedClassifierCV
├── v4_scaler.pkl         # StandardScaler
├── v4_feature_names.json # 11개 피처 목록
└── v4_metadata.json      # 메타데이터
```

---

## 6. 성능 비교 요약

| 버전 | 피처 | 정확도 | Brier | AUC-ROC |
|------|------|--------|-------|---------|
| V1 | 16 | 70.11% | 0.2069 | 0.7628 |
| V3 | 26 | 72.69% | 0.1972 | 0.7605 |
| V4 | 10 | 74.32% | 0.1959 | 0.7733 |
| V4.1 | 11 | 75.10% | 0.1954 | 0.7769 |
| **V4.2** | **11** | **74.32%** | **0.1949** | **0.7790** |

---

## 7. 실험 코드 위치

```
scripts/benchmark/
├── prepare_unified_dataset.py    # 통합 데이터셋 준비
├── unified_evaluator.py          # 통합 평가 프레임워크
├── feature_vs_model_experiment.py # 피처 vs 모델 효과 분석
└── evaluate_v4.py                # V4 평가

scripts/experiments/
├── momentum_optimization.py      # 모멘텀 윈도우 최적화
├── momentum_optimization_v2.py   # 상대강도 가중 실험
├── v4_plus_opp_strength.py       # 상대강도 피처 테스트
├── rebound_feature_test.py       # 리바운드 피처 실험
└── weight_optimization.py        # 가중치 최적화 (Phase 1-4)

reports/
└── model_comparison_report.md    # V1/V2/V3 비교 보고서
```

---

## 8. 향후 개선 방향

1. **시계열 교차검증:** 3시즌 전체 데이터로 안정성 검증
2. **피처 축소:** 민감도 0인 피처 제거 검토
3. **실시간 피처:** 부상, 출장 정보 반영
4. **시즌 누적 데이터:** 시즌 진행에 따른 모델 업데이트

---

*Generated by BucketsVision Development Team*
